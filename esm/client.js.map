{"version":3,"file":"client.js","sources":["../src/app/core/util/fromJSOrdered.js","../src/client/client.js"],"sourcesContent":["import { Seq } from 'immutable';\r\n\r\nconst fromJSOrdered = js => {\r\n  return typeof js !== 'object' || js === null\r\n    ? js\r\n    : Array.isArray(js)\r\n    ? Seq(js)\r\n        .map(fromJSOrdered)\r\n        .toList()\r\n    : Seq(js)\r\n        .map(fromJSOrdered)\r\n        .toOrderedMap();\r\n};\r\n\r\nexport default fromJSOrdered;\r\n","import 'isomorphic-fetch';\r\nimport React from 'react';\r\nimport { render, hydrate } from 'react-dom';\r\nimport { Router } from 'react-router-dom';\r\nimport { preloadReady } from 'react-loadable';\r\nimport { AppContainer } from 'react-hot-loader';\r\nimport { Provider as ReduxProvider } from 'react-redux';\r\nimport queryString from 'query-string';\r\nimport { fromJS } from 'immutable';\r\n\r\nimport createStore from '~/core/redux/store';\r\nimport rootSaga from '~/core/redux/sagas/index.js';\r\n\r\nimport { setVersionStatus } from '~/core/redux/actions/version';\r\nimport { GetClientSideDeliveryApiStatus } from '~/core/util/ContensisDeliveryApi';\r\nimport { setCurrentProject } from '~/core/redux/actions/routing';\r\nimport pickProject from '~/core/util/pickProject';\r\nimport fromJSOrdered from '~/core/util/fromJSOrdered';\r\nimport { browserHistory as history } from '~/core/redux/history';\r\n\r\nexport { default as ReactApp } from '~/App';\r\n\r\nclass ClientApp {\r\n  constructor(ReactApp, config) {\r\n    const documentRoot = document.getElementById('root');\r\n\r\n    const { routes, withReducers, withSagas, withEvents } = config;\r\n\r\n    const GetClientJSX = store => {\r\n      const ClientJsx = (\r\n        <AppContainer>\r\n          <ReduxProvider store={store}>\r\n            <Router history={history}>\r\n              <ReactApp routes={routes} withEvents={withEvents} />\r\n            </Router>\r\n          </ReduxProvider>\r\n        </AppContainer>\r\n      );\r\n      return ClientJsx;\r\n    };\r\n\r\n    const isProduction = !(process.env.NODE_ENV != 'production');\r\n\r\n    /**\r\n     * Webpack HMR Setup.\r\n     */\r\n    const HMRRenderer = Component => {\r\n      preloadReady().then(() => {\r\n        isProduction\r\n          ? hydrate(Component, documentRoot)\r\n          : render(Component, documentRoot);\r\n      });\r\n    };\r\n    let store = null;\r\n    const qs = queryString.parse(window.location.search);\r\n\r\n    const versionStatusFromHostname = GetClientSideDeliveryApiStatus();\r\n    if (\r\n      window.isDynamic ||\r\n      window.REDUX_DATA ||\r\n      process.env.NODE_ENV !== 'production'\r\n    ) {\r\n      store = createStore(\r\n        withReducers,\r\n        fromJSOrdered(window.REDUX_DATA),\r\n        history\r\n      );\r\n      store.dispatch(\r\n        setVersionStatus(qs.versionStatus || versionStatusFromHostname)\r\n      );\r\n\r\n      /* eslint-disable no-console */\r\n      console.log('Hydrating from inline Redux');\r\n      /* eslint-enable no-console */\r\n      store.runSaga(rootSaga(withSagas));\r\n      store.dispatch(\r\n        setCurrentProject(pickProject(window.location.hostname, qs))\r\n      );\r\n\r\n      delete window.REDUX_DATA;\r\n      HMRRenderer(GetClientJSX(store));\r\n    } else {\r\n      fetch(`${window.location.pathname}?redux=true`)\r\n        .then(response => response.json())\r\n        .then(data => {\r\n          /* eslint-disable no-console */\r\n          //console.log('Got Data Back');\r\n          // console.log(data);\r\n          /* eslint-enable no-console */\r\n          const ssRedux = JSON.parse(data);\r\n          store = createStore(withReducers, fromJS(ssRedux), history);\r\n          // store.dispatch(setVersionStatus(versionStatusFromHostname));\r\n\r\n          store.runSaga(rootSaga(withSagas));\r\n          store.dispatch(\r\n            setCurrentProject(\r\n              pickProject(\r\n                window.location.hostname,\r\n                queryString.parse(window.location.search)\r\n              )\r\n            )\r\n          );\r\n          // if (typeof window != 'undefined') {\r\n          //   store.dispatch(checkUserLoggedIn());\r\n          // }\r\n          HMRRenderer(GetClientJSX(store));\r\n        });\r\n    }\r\n\r\n    // webpack Hot Module Replacement API\r\n    if (module.hot) {\r\n      module.hot.accept(ReactApp, () => {\r\n        // if you are using harmony modules ({modules:false})\r\n        HMRRenderer(GetClientJSX(store));\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport default ClientApp;\r\n"],"names":["fromJSOrdered","js","Array","isArray","Seq","map","toList","toOrderedMap","ClientApp","constructor","ReactApp","config","documentRoot","document","getElementById","routes","withReducers","withSagas","withEvents","GetClientJSX","store","ClientJsx","ReduxProvider","history","isProduction","process","env","NODE_ENV","HMRRenderer","Component","preloadReady","then","hydrate","render","qs","queryString","parse","window","location","search","versionStatusFromHostname","GetClientSideDeliveryApiStatus","isDynamic","REDUX_DATA","createStore","dispatch","setVersionStatus","versionStatus","console","log","runSaga","rootSaga","setCurrentProject","pickProject","hostname","fetch","pathname","response","json","data","ssRedux","JSON","fromJS","module","hot","accept"],"mappings":"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"}