{"version":3,"file":"client.js","sources":["../src/app/core/util/fromJSLeaveImmer.js","../src/client/client.js"],"sourcesContent":["import { OrderedMap } from 'immutable';\nimport fromJSOrdered from './fromJSOrdered';\n\nconst fromJSLeaveImmer = (js, immerFeatureRootProps = null) => {\n  console.info(js);\n  if (typeof js !== 'object' || js === null) return js;\n  if (!immerFeatureRootProps || !Object.keys(immerFeatureRootProps).length)\n    return fromJSOrdered(js);\n  const convertedObject = OrderedMap();\n  const keys = Object.keys(js);\n  keys.forEach(key => {\n    if (immerFeatureRootProps.indexOf(key) > -1) {\n      convertedObject.set(key, js[key]);\n      console.info(`LOOK! - immer untouched bar root key \"${key}\"`);\n    } else {\n      console.info(`LOOK! - normal immutable feature \"${key}\"`);\n      convertedObject.set(key, fromJSOrdered(js));\n    }\n  });\n};\n\nexport default fromJSLeaveImmer;\n","import 'isomorphic-fetch';\nimport React from 'react';\nimport { render, hydrate } from 'react-dom';\nimport { Router } from 'react-router-dom';\nimport { preloadReady } from 'react-loadable';\nimport { AppContainer } from 'react-hot-loader';\nimport { Provider as ReduxProvider } from 'react-redux';\nimport queryString from 'query-string';\n\nimport createStore from '~/core/redux/store';\nimport rootSaga from '~/core/redux/sagas/index.js';\n\nimport { setVersionStatus } from '~/core/redux/actions/version';\nimport { deliveryApi } from '~/core/util/ContensisDeliveryApi';\nimport { setCurrentProject } from '~/core/redux/actions/routing';\nimport pickProject from '~/core/util/pickProject';\nimport { browserHistory as history } from '~/core/redux/history';\nimport fromJSLeaveImmer from '~/core/util/fromJSLeaveImmer';\n\nexport { default as ReactApp } from '~/App';\n\nclass ClientApp {\n  constructor(ReactApp, config) {\n    const documentRoot = document.getElementById('root');\n\n    const {\n      routes,\n      withReducers,\n      withReducersImmer,\n      withSagas,\n      withEvents,\n    } = config;\n\n    const GetClientJSX = store => {\n      const ClientJsx = (\n        <AppContainer>\n          <ReduxProvider store={store}>\n            <Router history={history}>\n              <ReactApp routes={routes} withEvents={withEvents} />\n            </Router>\n          </ReduxProvider>\n        </AppContainer>\n      );\n      return ClientJsx;\n    };\n\n    const isProduction = !(process.env.NODE_ENV != 'production');\n\n    /**\n     * Webpack HMR Setup.\n     */\n    const HMRRenderer = Component => {\n      preloadReady().then(() => {\n        isProduction\n          ? hydrate(Component, documentRoot)\n          : render(Component, documentRoot);\n      });\n    };\n    let store = null;\n    const qs = queryString.parse(window.location.search);\n\n    const versionStatusFromHostname = deliveryApi.getClientSideVersionStatus();\n    if (\n      window.isDynamic ||\n      window.REDUX_DATA ||\n      process.env.NODE_ENV !== 'production'\n    ) {\n      store = createStore(\n        withReducers,\n        fromJSLeaveImmer(\n          window.REDUX_DATA,\n          withReducersImmer ? Object.keys(withReducersImmer) : null\n        ),\n        history,\n        withReducersImmer\n      );\n      store.dispatch(\n        setVersionStatus(qs.versionStatus || versionStatusFromHostname)\n      );\n\n      /* eslint-disable no-console */\n      console.log('Hydrating from inline Redux');\n      /* eslint-enable no-console */\n      store.runSaga(rootSaga(withSagas));\n      store.dispatch(\n        setCurrentProject(pickProject(window.location.hostname, qs))\n      );\n\n      delete window.REDUX_DATA;\n      HMRRenderer(GetClientJSX(store));\n    } else {\n      fetch(`${window.location.pathname}?redux=true`)\n        .then(response => response.json())\n        .then(data => {\n          /* eslint-disable no-console */\n          //console.log('Got Data Back');\n          // console.log(data);\n          /* eslint-enable no-console */\n          const ssRedux = JSON.parse(data);\n          store = createStore(\n            withReducers,\n            fromJSLeaveImmer(\n              ssRedux,\n              withReducersImmer ? Object.keys(withReducersImmer) : null\n            ),\n            history,\n            withReducersImmer\n          );\n          // store.dispatch(setVersionStatus(versionStatusFromHostname));\n\n          store.runSaga(rootSaga(withSagas));\n          store.dispatch(\n            setCurrentProject(\n              pickProject(\n                window.location.hostname,\n                queryString.parse(window.location.search)\n              )\n            )\n          );\n          // if (typeof window != 'undefined') {\n          //   store.dispatch(checkUserLoggedIn());\n          // }\n          HMRRenderer(GetClientJSX(store));\n        });\n    }\n\n    // webpack Hot Module Replacement API\n    if (module.hot) {\n      module.hot.accept(ReactApp, () => {\n        // if you are using harmony modules ({modules:false})\n        HMRRenderer(GetClientJSX(store));\n      });\n    }\n  }\n}\n\nexport default ClientApp;\n"],"names":["fromJSLeaveImmer","js","immerFeatureRootProps","console","info","Object","keys","length","fromJSOrdered","convertedObject","OrderedMap","forEach","key","indexOf","set","ClientApp","constructor","ReactApp","config","documentRoot","document","getElementById","routes","withReducers","withReducersImmer","withSagas","withEvents","GetClientJSX","store","ClientJsx","React","AppContainer","ReduxProvider","Router","history","isProduction","process","env","NODE_ENV","HMRRenderer","Component","preloadReady","then","hydrate","render","qs","queryString","parse","window","location","search","versionStatusFromHostname","deliveryApi","getClientSideVersionStatus","isDynamic","REDUX_DATA","createStore","dispatch","setVersionStatus","versionStatus","log","runSaga","rootSaga","setCurrentProject","pickProject","hostname","fetch","pathname","response","json","data","ssRedux","JSON","module","hot","accept"],"mappings":"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"}