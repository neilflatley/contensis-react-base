{"version":3,"file":"RouteLoader-ca0b6243.js","sources":["../src/app/pages/NotFound.js","../src/app/core/routes/Status.js","../src/app/core/routes/RouteLoader.js"],"sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\n\r\nconst NotFound = ({ statusCode, statusText }) => (\r\n  <>\r\n    <header>\r\n      <h1>{statusCode || '404'} Page Not Found</h1>\r\n      {statusText && (\r\n        <h2\r\n          style={{\r\n            background: '#eee',\r\n            color: '#666',\r\n            fontSize: '100%',\r\n            padding: '10px',\r\n          }}\r\n        >\r\n          {statusText}\r\n        </h2>\r\n      )}\r\n    </header>\r\n  </>\r\n);\r\n\r\nNotFound.propTypes = {\r\n  statusCode: PropTypes.number,\r\n  statusText: PropTypes.string,\r\n};\r\n\r\nexport default NotFound;\r\n","import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { Route } from 'react-router-dom';\r\n\r\nexport const Status = ({ code, children }) => {\r\n  return (\r\n    <Route\r\n      render={({ staticContext }) => {\r\n        if (staticContext) staticContext.status = code;\r\n        return children;\r\n      }}\r\n    />\r\n  );\r\n};\r\n\r\nStatus.propTypes = {\r\n  code: PropTypes.number.isRequired,\r\n  children: PropTypes.element,\r\n};\r\n","import React, { useEffect, useCallback } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { connect } from 'react-redux';\r\nimport { hot } from 'react-hot-loader';\r\nimport { Redirect, useLocation } from 'react-router-dom';\r\nimport { renderRoutes, matchRoutes } from 'react-router-config';\r\n\r\nimport {\r\n  selectCurrentPath,\r\n  selectCurrentProject,\r\n  selectIsNotFound,\r\n  selectMappedEntry,\r\n  selectRouteEntry,\r\n  selectRouteEntryContentTypeId,\r\n  selectRouteErrorMessage,\r\n  selectRouteIsError,\r\n  selectRouteLoading,\r\n  selectRouteStatusCode,\r\n} from '~/core/redux/selectors/routing';\r\nimport { setNavigationPath } from '~/core/redux/actions/routing';\r\nimport NotFound from '~/pages/NotFound';\r\n\r\nimport { Status } from './Status';\r\nimport { toJS } from '../util/ToJs';\r\nimport {\r\n  selectUserGroups,\r\n  selectUserIsAuthenticated,\r\n} from '~/features/login/redux/selectors';\r\nimport { matchUserGroup } from '~/features/login/util/matchGroups';\r\n\r\nconst getTrimmedPath = path => {\r\n  if (path !== '/') {\r\n    const lastChar = path[path.length - 1];\r\n    if (lastChar == '/') {\r\n      return path.substring(0, path.length - 1);\r\n    }\r\n  }\r\n  return path;\r\n};\r\n\r\nconst RouteLoader = ({\r\n  contentTypeId,\r\n  entry,\r\n  isError,\r\n  isLoading,\r\n  isLoggedIn,\r\n  isNotFound,\r\n  loadingComponent,\r\n  mappedEntry,\r\n  notFoundComponent,\r\n  projectId,\r\n  routes,\r\n  setNavigationPath,\r\n  statePath,\r\n  statusCode,\r\n  statusText,\r\n  userGroups,\r\n  withEvents,\r\n}) => {\r\n  const location = useLocation();\r\n  const trimmedPath = getTrimmedPath(location.pathname);\r\n\r\n  // Match any Static Routes a developer has defined\r\n  const matchedStaticRoute = () =>\r\n    matchRoutes(routes.StaticRoutes, location.pathname);\r\n  const isStaticRoute = () => matchedStaticRoute().length > 0;\r\n\r\n  const staticRoute = isStaticRoute() && matchedStaticRoute()[0];\r\n  const routeRequiresLogin = staticRoute && staticRoute.route.requireLogin;\r\n\r\n  const setPath = useCallback(() => {\r\n    let serverPath = null;\r\n    if (staticRoute && staticRoute.match && staticRoute.match.isExact) {\r\n      serverPath = staticRoute.route.path.includes('*')\r\n        ? staticRoute.match.url\r\n        : staticRoute.route.path\r\n            .split('/')\r\n            .filter(p => !p.startsWith(':'))\r\n            .join('/');\r\n    }\r\n\r\n    setNavigationPath(\r\n      serverPath || trimmedPath,\r\n      location,\r\n      staticRoute,\r\n      withEvents,\r\n      statePath,\r\n      routes\r\n    );\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [\r\n    setNavigationPath,\r\n    // staticRoute,\r\n    withEvents,\r\n    location,\r\n    routes,\r\n    // statePath,\r\n    trimmedPath,\r\n  ]);\r\n\r\n  if (typeof window == 'undefined') setPath();\r\n\r\n  useEffect(() => {\r\n    setPath();\r\n  }, [location, setPath]);\r\n\r\n  // Need to redirect when url endswith a /\r\n  if (location.pathname.length > trimmedPath.length) {\r\n    return <Redirect to={trimmedPath} />;\r\n  }\r\n  // Render any Static Routes a developer has defined\r\n  if (isStaticRoute(trimmedPath) && !(!isLoggedIn && routeRequiresLogin)) {\r\n    if (matchUserGroup(userGroups, routeRequiresLogin))\r\n      return renderRoutes(routes.StaticRoutes, {\r\n        projectId,\r\n        contentTypeId,\r\n        entry,\r\n        mappedEntry,\r\n        isLoggedIn,\r\n      });\r\n  }\r\n\r\n  // Render a supplied Loading component if the route\r\n  // is not a static route and is in a loading state\r\n  if (isLoading && !isNotFound && loadingComponent) {\r\n    const LoadingComponent = loadingComponent;\r\n    return <LoadingComponent />;\r\n  }\r\n\r\n  // Match any defined Content Type Mappings\r\n  if (contentTypeId && !(!isLoggedIn && routeRequiresLogin)) {\r\n    const MatchedComponent = routes.ContentTypeMappings.find(\r\n      item => item.contentTypeID == contentTypeId\r\n    );\r\n\r\n    // debugger;\r\n    if (MatchedComponent && !(MatchedComponent.requireLogin && !isLoggedIn)) {\r\n      if (matchUserGroup(userGroups, MatchedComponent.requireLogin))\r\n        return (\r\n          <MatchedComponent.component\r\n            projectId={projectId}\r\n            contentTypeId={contentTypeId}\r\n            entry={entry}\r\n            mappedEntry={mappedEntry}\r\n            isLoggedIn={isLoggedIn}\r\n          />\r\n        );\r\n    }\r\n  }\r\n\r\n  const NotFoundComponent = notFoundComponent ? notFoundComponent : NotFound;\r\n  if (isNotFound || isError) {\r\n    return (\r\n      <Status code={statusCode}>\r\n        <NotFoundComponent statusCode={statusCode} statusText={statusText} />\r\n      </Status>\r\n    );\r\n  }\r\n\r\n  return null;\r\n};\r\n\r\nRouteLoader.propTypes = {\r\n  contentTypeId: PropTypes.string,\r\n  entry: PropTypes.object,\r\n  isError: PropTypes.bool,\r\n  isLoading: PropTypes.bool,\r\n  isLoggedIn: PropTypes.bool,\r\n  isNotFound: PropTypes.bool,\r\n  loadingComponent: PropTypes.func,\r\n  mappedEntry: PropTypes.object,\r\n  notFoundComponent: PropTypes.func,\r\n  projectId: PropTypes.string,\r\n  routes: PropTypes.objectOf(PropTypes.array, PropTypes.array),\r\n  setNavigationPath: PropTypes.func,\r\n  statePath: PropTypes.string,\r\n  statusCode: PropTypes.number,\r\n  statusText: PropTypes.string,\r\n  userGroups: PropTypes.array,\r\n  withEvents: PropTypes.object,\r\n};\r\n\r\nconst mapStateToProps = state => {\r\n  return {\r\n    contentTypeId: selectRouteEntryContentTypeId(state),\r\n    entry: selectRouteEntry(state),\r\n    isError: selectRouteIsError(state),\r\n    isNotFound: selectIsNotFound(state),\r\n    isLoading: selectRouteLoading(state),\r\n    isLoggedIn: selectUserIsAuthenticated(state),\r\n    mappedEntry: selectMappedEntry(state),\r\n    projectId: selectCurrentProject(state),\r\n    statePath: selectCurrentPath(state),\r\n    statusCode: selectRouteStatusCode(state),\r\n    statusText: selectRouteErrorMessage(state),\r\n    userGroups: selectUserGroups(state),\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = {\r\n  setNavigationPath,\r\n};\r\n\r\nexport default hot(module)(\r\n  connect(\r\n    mapStateToProps,\r\n    mapDispatchToProps\r\n  )(toJS(RouteLoader))\r\n);\r\n"],"names":["NotFound","statusCode","statusText","React","background","color","fontSize","padding","propTypes","PropTypes","number","string","Status","code","children","Route","staticContext","status","isRequired","element","getTrimmedPath","path","lastChar","length","substring","RouteLoader","contentTypeId","entry","isError","isLoading","isLoggedIn","isNotFound","loadingComponent","mappedEntry","notFoundComponent","projectId","routes","setNavigationPath","statePath","userGroups","withEvents","location","useLocation","trimmedPath","pathname","matchedStaticRoute","matchRoutes","StaticRoutes","isStaticRoute","staticRoute","routeRequiresLogin","route","requireLogin","setPath","useCallback","serverPath","match","isExact","includes","url","split","filter","p","startsWith","join","window","useEffect","Redirect","matchUserGroup","renderRoutes","LoadingComponent","MatchedComponent","ContentTypeMappings","find","item","contentTypeID","NotFoundComponent","object","bool","func","objectOf","array","mapStateToProps","state","selectRouteEntryContentTypeId","selectRouteEntry","selectRouteIsError","selectIsNotFound","selectRouteLoading","selectUserIsAuthenticated","selectMappedEntry","selectCurrentProject","selectCurrentPath","selectRouteStatusCode","selectRouteErrorMessage","selectUserGroups","mapDispatchToProps","hot","module","connect","toJS"],"mappings":"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"}